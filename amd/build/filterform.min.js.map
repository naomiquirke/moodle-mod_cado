{"version":3,"file":"filterform.min.js","sources":["../src/filterform.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/*\n * Provides interface for users to edit courseflow activity flow on the\n * courseflow mod editing form.\n *\n * @package    mod_courseflow\n * @copyright  2020 Naomi Quirke\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n*/\n\n/**\n * @module mod_cado/filterform\n */\ndefine([],\n    function() {\n        /**\n         * @alias module:mod_cado/filterform\n         */\n\n        return {\n            init: function(cadolist) {\n                // Var cadolist has records from Cado: id and name; from Course: shortname, fullname, startdate.\n                const cadoids = Object.entries(JSON.parse(document.querySelector(cadolist).value));\n                const dateselects = document.querySelectorAll(\"select[id^='id_compare']\");\n                dateselects.forEach(function(dateselect) {\n                    dateselect.addEventListener('change', updatechoices);\n                });\n\n                const coursename = document.getElementById('id_coursename');\n                coursename.addEventListener('change', updatechoices);\n                const cadochoice = document.getElementById('id_cadoid');\n                updatechoices();\n\n                /** Changing the content of cadochoice selector. */\n                function updatechoices() {\n                    // First remove existing.\n                    while (cadochoice.firstChild) {\n                        cadochoice.removeChild(cadochoice.firstChild);\n                    }\n                    cadochoice.insertAdjacentHTML('afterbegin', `<option value=\"0\">---</option>`);\n                    cadochoice.selectedIndex = 0;\n                    let sdate = new Date(document.getElementById('id_comparestartdate_year').value,\n                        document.getElementById('id_comparestartdate_month').value - 1,\n                        document.getElementById('id_comparestartdate_day').value);\n                    let startdate = Math.floor(sdate.getTime() / 1000);\n                    let edate = new Date(document.getElementById('id_compareenddate_year').value,\n                        document.getElementById('id_compareenddate_month').value,\n                        document.getElementById('id_compareenddate_day').value);\n                    let enddate = Math.floor(edate.getTime() / 1000);\n\n                    cadoids.forEach(function(value) {\n                        if ((value[1].startdate >= startdate) &&\n                            (value[1].startdate <= enddate) &&\n                            (value[1].shortname.indexOf(coursename.value) >= 0)) {\n                            cadochoice.insertAdjacentHTML('afterbegin',\n                                `<option value=${value[0]}>${value[1].shortname} --- ${value[1].name}</option>`);\n                        }\n                    });\n                }\n\n            }\n        };\n    }\n);\n"],"names":["define","init","cadolist","cadoids","Object","entries","JSON","parse","document","querySelector","value","querySelectorAll","forEach","dateselect","addEventListener","updatechoices","coursename","getElementById","cadochoice","firstChild","removeChild","insertAdjacentHTML","selectedIndex","sdate","Date","startdate","Math","floor","getTime","edate","enddate","shortname","indexOf","name"],"mappings":";;;;;;;;AA2BAA,6BAAO,IACH,iBAKW,CACHC,KAAM,SAASC,gBAELC,QAAUC,OAAOC,QAAQC,KAAKC,MAAMC,SAASC,cAAcP,UAAUQ,QACvDF,SAASG,iBAAiB,4BAClCC,SAAQ,SAASC,YACzBA,WAAWC,iBAAiB,SAAUC,wBAGpCC,WAAaR,SAASS,eAAe,iBAC3CD,WAAWF,iBAAiB,SAAUC,qBAChCG,WAAaV,SAASS,eAAe,sBAIlCF,qBAEEG,WAAWC,YACdD,WAAWE,YAAYF,WAAWC,YAEtCD,WAAWG,mBAAmB,+CAC9BH,WAAWI,cAAgB,MACvBC,MAAQ,IAAIC,KAAKhB,SAASS,eAAe,4BAA4BP,MACrEF,SAASS,eAAe,6BAA6BP,MAAQ,EAC7DF,SAASS,eAAe,2BAA2BP,OACnDe,UAAYC,KAAKC,MAAMJ,MAAMK,UAAY,KACzCC,MAAQ,IAAIL,KAAKhB,SAASS,eAAe,0BAA0BP,MACnEF,SAASS,eAAe,2BAA2BP,MACnDF,SAASS,eAAe,yBAAyBP,OACjDoB,QAAUJ,KAAKC,MAAME,MAAMD,UAAY,KAE3CzB,QAAQS,SAAQ,SAASF,OAChBA,MAAM,GAAGe,WAAaA,WACtBf,MAAM,GAAGe,WAAaK,SACtBpB,MAAM,GAAGqB,UAAUC,QAAQhB,WAAWN,QAAU,GACjDQ,WAAWG,mBAAmB,qCACTX,MAAM,eAAMA,MAAM,GAAGqB,0BAAiBrB,MAAM,GAAGuB,sBAxBhFlB"}